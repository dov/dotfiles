{% extends "pricing/base.html" %}

{% block htmlhead %}{{ block.super }}
<script type="text/javascript" src="/site_media/js/jquery.js"></script>
<script type="text/javascript" >
    $(function() {
        // onchange of first input in each table row,
        // change all other inputs in that row to have same val
        // do once only.
        var seniortyFinder = new RegExp(/_seniority-(\d)_/);

        var table_id = 'hourly_table';
        $('#'+ table_id + ' td.first input').each( function () {
            var thisSeniority = seniortyFinder.exec($(this).attr('name'))[1];
            var $otherInputsInThisRow = $('#'+ table_id + ' td input[name*=seniority-'+thisSeniority+']');
            this.done = false;
            $(this).bind('change', function () {
                if (!this.done) {
                    this.done = true;
                    $that = $(this);
                    $otherInputsInThisRow.each(function () {
                        if ($(this)!==$that) {
                            $(this).val($that.val());
                        }
                    });
                }
            });
                
        });
    
        var table_id = 'fixed_table';
        $('#'+ table_id + ' td.first input').each( function () {
            var thisSeniority = seniortyFinder.exec($(this).attr('name'))[1];
            var $otherInputsInThisRow = $('#'+ table_id + ' td input[name*=seniority-'+thisSeniority+']');
            this.done = false;
            $(this).bind('change', function () {
                if (!this.done) {
                    this.done = true;
                    $that = $(this);
                    $otherInputsInThisRow.each(function () {
                        if ($(this)!==$that && $that.val()=='N/A') {
                            $(this).val($that.val());
                        }
                    });
                }
            });
                
        });
    });
</script>
{% endblock %}
{% block content %}
{% load getattribute %}

 <h2>Edit Fee Structure</h2>

    <p>Please fill in every box of both the fixed and hourly fees table</p>
    <p>You should specify a single fee, expressed in whole £s,
    for every relevant seniority and type of work.
    For the purpose of the database we are asking you to quote standard rates
    for cases of average complexity, with normal volumes of papers.</p>
    <p>Enter "N/A" for fees not applicable.</p>
    <p>As you fill in the first entry in a row, other entries may 'autofill'
    with the most commonly used values for the rest of the row.  You may
    override these entries if you wish.</p>

<form action="" method="POST" >
    <p>
        <em>Fee Structure Name: </em>
        {% for field in form %}
        {% if field.name == 'name' %}
            {{field}}
        {% endif %}
        {% endfor %}
    </p>

{% for fee_type in form.fee_types %}
  <h3>{{fee_type}}s</h3>
  <table
      id="{% if 'hourly' in fee_type.name|lower %}hourly_table{%else%}fixed_table{%endif%}"
      border="1" summary="fee structure table">
  	<thead>
    <tr>
    	<th>Seniority</th>
    	{% for worktype in form.worktypes%}
  	    {% if worktype.fee_type = fee_type %}
        <th><a class="notbold" href="{% url worktype_definition worktype.id %}">{{worktype}}</a></th>
          {%endif%}
    	{%endfor%}
	</tr>
	</thead>
	<tbody>
	  {%for seniority in form.seniorities%}
      <tr class="{% cycle 'row1' 'row2' %}">
               <th>{{seniority}}</th>
                  {% for type_of_work in form.worktypes %}
                  {% if type_of_work.fee_type = fee_type %}
                      {% if '1.' in type_of_work.name %}
                          <td class="first">
                      {%else%}
                          <td>
                      {%endif%}
                      {% for field in form %}
                        {% if field.field.seniority == seniority and field.field.type_of_work == type_of_work and field.field.fee_type == fee_type %}
                        {{field.errors}}£ {{field}}
                        {% endif %}
                      {% endfor %}
                  </td>
                  {%endif%}
                  {%endfor%}
	    </tr>
         {%endfor%}
	 </tbody>
  </table>
{%endfor%}
<p>All information that you submit will be kept confidential and secure
and no other chambers will be able to view your data.
The fixed fees you quote should include all the matters set out in the
definitions provided but they will not be contractually binding on your
chambers and it will be open to you to negotiate extra fees in special 
circumstances.</p>

<p>Click here to save this fee structure. 
You may enter alternative fee structures,
and assign them to the various framework panels,
on the next screen</p>
<p>
  <input type="submit" value="Submit" />
</p>
 </form>

{% endblock content %}
